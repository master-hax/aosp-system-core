{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f1ef9b4c_fd4f3d5c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1125653
      },
      "writtenOn": "2020-10-26T19:11:13Z",
      "side": 1,
      "message": "Ick, no, just set the proper init config variable setting for your host controller device and all should be fine.\n\nThis should have been resolved in device configurations a long time ago, what ones are currently not working because of this kernel change?",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2fc56ff0_1a3cebf6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1125653
      },
      "writtenOn": "2020-10-26T19:11:43Z",
      "side": 1,
      "message": "See https://android-review.googlesource.com/c/device/linaro/dragonboard/+/1349264 for how to do this correctly for your device.",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7e4a1a1a_a4af0031",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1125653
      },
      "writtenOn": "2020-10-26T19:14:43Z",
      "side": 1,
      "message": "Also, some testing systems want to set the dummy_udc device, so I think this will break them.  There\u0027s a reason we added it to the kernel configuration :)\n",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dc5aa3cc_c7989cd4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-10-26T19:43:17Z",
      "side": 1,
      "message": "Note: I\u0027m +1\u0027ing this just to remove the ORV requirement, while others can review.  I\u0027ve wanted this, along with the rest of the USB special cases, removed from init for years.",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f031d26c_3d025e18",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1030767
      },
      "writtenOn": "2020-10-26T20:50:09Z",
      "side": 1,
      "message": "\u003e Ick, no, just set the proper init config variable setting for your host controller device and all should be fine.\n\n\u003e See https://android-review.googlesource.com/c/device/linaro/dragonboard/+/1349264 for how to do this correctly for your device.\n\nOk that\u0027s fair. We usually do have the proper init on our QCOM boards\u0027 init.*.rc. But caught a case that didn\u0027t have it set in time before the ConfigFS rules are executed resulting in dummy_udc getting selected. On these boards the previous behavior relied on init having chosen the correct one, so that\u0027s what sparked this change--its purpose was to allow init to choose a \"reasonable\" default.\n\n\n\u003e Also, some testing systems want to set the dummy_udc device, so I think this will break them.  There\u0027s a reason we added it to the kernel configuration :)\n\nWhy can\u0027t the argument extend to these systems as well, couldn\u0027t their init.*.rc set sys.usb.controller\u003ddummy_udc.0 explicitly for testing purposes?",
      "parentUuid": "f1ef9b4c_fd4f3d5c",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5173daac_cfdeea07",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1030767
      },
      "writtenOn": "2020-10-26T20:58:30Z",
      "side": 1,
      "message": "\u003e I\u0027ve wanted this, along with the rest of the USB special cases, removed from init for years.\n\nQCOM would be ok with that. At least for our boards we can make sure to always have the property set from init.${ro.hardware}.rc or /vendor/{build,default}.prop\n\nIs there an easy way to cushion the blow for boards that aren\u0027t prepared for it? Maybe keep SetUsbController() for now but have it issue a warning if the property value wasn\u0027t already set and it had to pick a default?",
      "parentUuid": "dc5aa3cc_c7989cd4",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d4ffa33_4d7b5f49",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1125653
      },
      "writtenOn": "2020-10-27T08:27:26Z",
      "side": 1,
      "message": "Their systems can set that value explicitly, but you can never know the order of enumeration for any type of dynamic device, like this.  So don\u0027t assume that the \"first\" one will be the one for you, as that will, and can, change over time.\n\nThere is nothing \"special\" about the dummy hcd controller here, it is a valid USB controller as any other one, so please don\u0027t try to treat it differently here in a hard-coded .cpp file.",
      "parentUuid": "f031d26c_3d025e18",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c65f1ec_0862accd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1030767
      },
      "writtenOn": "2020-10-27T21:13:18Z",
      "side": 1,
      "message": "It really does sound to me that init.cpp has no business in even setting sys.usb.controller in the first place, acceding to Tom\u0027s point?\n\nI can imagine another case when doing it from init.cpp could backfire--if the property had been set already during bootup from an init RC or even .prop file, but happens before SetUsbController() is called by init, then it would get overridden by whatever \"first\" device it finds under /sys/class/udc.\n\nI\u0027m fine to abandon this change but should we forge ahead toward removing SetUsbController() completely then?",
      "parentUuid": "1d4ffa33_4d7b5f49",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee524a61_4eb02f56",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-10-27T21:22:27Z",
      "side": 1,
      "message": "Agreed.  SetUsbController() is called after prop files are loaded, which is unfortunate, but kept there for legacy reasons.\n\nThere is a new call added in the main loop for GKI.  +salyzyn@ for comments.\n\nOverall, the USB team needs to take provide an alternative.  We\u0027ve kept this logic for backwards compatibility for a long time, and it appears that GKI is exposing enough issues with it, that it\u0027s time to replace it.  Perhaps a requirement for devices launching with GKI could be to specify `sys.usb.controller` explicitly?",
      "parentUuid": "9c65f1ec_0862accd",
      "revId": "91d9cb713b7e8bfba7bb55bfe3053e07955691e0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}