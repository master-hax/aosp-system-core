{
  "comments": [
    {
      "key": {
        "uuid": "6b903951_cda9934e",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 35,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "stdlib.h",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "18230126_c24638c0",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 35,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6b903951_cda9934e",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26ec0b13_8e2a5329",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 82,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2019-10-10T07:51:15Z",
      "side": 1,
      "message": "unrelated to this CL, but should \"console\" be in this list?",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48d727e7_ea2375f8",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 82,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T13:56:18Z",
      "side": 1,
      "message": "+1; the original comment on the left side says that the console ignores SIGTERM.  We should keep that logic in the code somewhere.",
      "parentUuid": "26ec0b13_8e2a5329",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44f23cee_68350a2d",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 82,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Added console to the list.\n\nSince console is pre-data service, add bool only_post_data parameter to GetDebuggingServices.",
      "parentUuid": "48d727e7_ea2375f8",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b3174c4b_7ef18d0a",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 467,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "This is a subtle behavior change from before.  The loop would send SIGTERM multiple times, so if services for some reason respond differently when getting a subsequent SIGTERM, they won\u0027t get it now.  Also, if services are fork()\u0027ing children, we won\u0027t kill their process groups again.\n\nI don\u0027t think you need to change anything; just noting it for posterity.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d5821c38_929d3263",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2019-10-10T07:51:15Z",
      "side": 1,
      "message": "I noticed that Service::Reap() sets pid_ to 0; does that means this can be racy, where you receive the signal right after this check, and the child is already reaped, and you wait forever for it to be reaped again?",
      "range": {
        "startLine": 474,
        "startChar": 7,
        "endLine": 474,
        "endChar": 27
      },
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f4182d7_aabb3c8d",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T13:56:18Z",
      "side": 1,
      "message": "Good catch.  We don\u0027t call Service::Reap() in the signal handler; we only indicate to the main loop that it should call ReapAnyOutstandingChildren().  So there\u0027s no race with the signal handler itself.\n\nBut the call to ReapAnyOutstandingChildren() before WaitToBeReaped() would race.  We should remove the ReapAnyOutstandingChildren() call and only allow WaitToBeReaped() to reap any children after we collect the list of pids.",
      "parentUuid": "d5821c38_929d3263",
      "range": {
        "startLine": 474,
        "startChar": 7,
        "endLine": 474,
        "endChar": 27
      },
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b056194_9b152399",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Oh, good catch! Moved this before stopping a service.\n\nTo preserver original behaviour, if timeout is 0ms, StopServices will call ReapAnyOutstandingChildren instead of WaitToBeReaped.",
      "parentUuid": "d5821c38_929d3263",
      "range": {
        "startLine": 474,
        "startChar": 7,
        "endLine": 474,
        "endChar": 27
      },
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b298c903_d8012d2d",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 628,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "We might as well log the violators here and line 631 too.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d5fbcf3f_bb8f3211",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 628,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b298c903_d8012d2d",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c4dd646e_a556e502",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 696,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "You don\u0027t want to set this again.  The \u0027exec\u0027 flag comes from the `exec` or `exec_start` init command, which runs a given service and blocks init from executing further commands until it has finished.\n\nWe unset it in shutdown when we clear the queue and stop waiting on properties, since we don\u0027t want anything blocking init; we want to go directly to shutdown.  You\u0027re probably safe doing the same thing for soft reboot, since you\u0027ll just end up killing that service during soft reboot.  But in no case would you want to set this flag again for any services.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f7771f1e_60018065",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 696,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c4dd646e_a556e502",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f68dfe5c_94327cef",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 720,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "I think you can call property_set() directly now.  property_service runs as a separate thread, so there shouldn\u0027t be the previous dead lock.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0e24d783_e368c6c3",
        "filename": "init/reboot.cpp",
        "patchSetId": 2
      },
      "lineNbr": 720,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f68dfe5c_94327cef",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "17681424_29609e81",
        "filename": "init/service.cpp",
        "patchSetId": 2
      },
      "lineNbr": 615,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "I think it\u0027s better if you just have a \n\nif (terminate) {\n  service-\u003eTerminate();\n} else {\n  service-\u003eStop();\n}\n\nconditional in StopServices().  Especially given this \u0027else\u0027 case that may be misused by future callers.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6439440e_ab6414df",
        "filename": "init/service.cpp",
        "patchSetId": 2
      },
      "lineNbr": 615,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "17681424_29609e81",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "993a65e9_510a9ba3",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "You don\u0027t need this here if you have it in the related header.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "33a18d3b_3b993566",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 30,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "993a65e9_510a9ba3",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "83235df4_ff1f08e1",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 31,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "This should be in a group by itself between the libc includes and the other project includes.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b7c74ee_f5e164ab",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 31,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "83235df4_ff1f08e1",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ba2b405a_b47b33b9",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "As confusing as it is, remove_if() doesn\u0027t actually delete items from a container.\n\nSee https://en.wikipedia.org/wiki/Eraseâ€“remove_idiom",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8e9a991_520c5cf5",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done. Thanks!",
      "parentUuid": "ba2b405a_b47b33b9",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49d1b673_eee73fba",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 120,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "There\u0027s a race here since waitpid() will reap zombies.  You only want waitid() / waitpid() to be called in ReapOneProcess().  \n\nYou should make ReapOneProcess() return the pid that it has reaped and then you can delete it from alive_pids.\n\nSleeping between each reaped process is going to take a long time too.  You probably want to do something like this:\n\nwhile (!alive_pids.empty() \u0026\u0026 t.duration() \u003c timeout) {\n  pid_t pid \u003d ReapOneProcess();\n  while (pid !\u003d 0) {\n    auto it \u003d std::find(alive_pids.begin(), alive_pids.end(), pid);\n    if (it !\u003d alive_pids.end()) {\n      alive_pids.erase(it);\n    }\n    pid \u003d ReapOneProcess();\n  }\n  if (alive_pids.empty()) {\n    break;\n  }\n  std::this_thread::sleep_for(50ms);\n}",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efbdb6e3_1e2b824a",
        "filename": "init/sigchld_handler.cpp",
        "patchSetId": 2
      },
      "lineNbr": 120,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "49d1b673_eee73fba",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e401a1e0_cc1ee4f8",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 921,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "I should have seen this before, no \u0027:\u0027 at the end.",
      "range": {
        "startLine": 921,
        "startChar": 19,
        "endLine": 921,
        "endChar": 20
      },
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "53397e34_7b63f382",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 921,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "e401a1e0_cc1ee4f8",
      "range": {
        "startLine": 921,
        "startChar": 19,
        "endLine": 921,
        "endChar": 20
      },
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "77a8c718_019a161b",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 926,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "Thanks; I do think this is the right way to do this.",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "557887fc_be72c876",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 926,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "77a8c718_019a161b",
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b187b6dd_d4dcff0e",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 928,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-10-10T01:03:04Z",
      "side": 1,
      "message": "Same here.",
      "range": {
        "startLine": 928,
        "startChar": 26,
        "endLine": 928,
        "endChar": 27
      },
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ad88db5b_70e72067",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 928,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-10-10T16:41:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b187b6dd_d4dcff0e",
      "range": {
        "startLine": 928,
        "startChar": 26,
        "endLine": 928,
        "endChar": 27
      },
      "revId": "651d1b90e5d79b558f7cf1ed2e80191ef2cfd017",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}